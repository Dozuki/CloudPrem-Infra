{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "default",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "iteration": 1625756839619,
  "links": [],
  "panels": [
    {
      "content": "# Work Order History Dashboard\nAn overview of all work orders completed in the current period",
      "datasource": null,
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 9,
      "links": [],
      "mode": "markdown",
      "options": {
        "content": "# Work Order History Dashboard\nAn overview of all work orders completed in the current period",
        "mode": "markdown"
      },
      "pluginVersion": "7.1.0",
      "title": "Panel Title",
      "transparent": true,
      "type": "text"
    },
    {
      "collapsed": false,
      "datasource": null,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 4
      },
      "id": 11,
      "panels": [],
      "title": "Work Order Historical Trend",
      "type": "row"
    },
    {
      "aliasColors": {
        "# of Work Orders": "#6990ad"
      },
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "$GUIDE_DB",
      "description": "Filtered by team, user, category, guide, and date range.",
      "fieldConfig": {
        "defaults": {
          "custom": {},
          "unit": "none"
        },
        "overrides": []
      },
      "fill": 0,
      "fillGradient": 7,
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 5
      },
      "hiddenSeries": false,
      "hideTimeOverride": false,
      "id": 1,
      "legend": {
        "alignAsTable": false,
        "avg": false,
        "current": false,
        "hideEmpty": false,
        "hideZero": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 2,
      "links": [],
      "nullPointMode": "null",
      "options": {
        "alertThreshold": false
      },
      "percentage": false,
      "pluginVersion": "7.2.0",
      "pointradius": 2,
      "points": true,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "alias": "",
          "format": "time_series",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "select \r\n-- UNIX_TIMESTAMP(from_unixtime(wl.starttime)) as time_sec,\r\nmax(wl.starttime*1000) as time_sec,\r\n\r\n\"# of Work Orders\" as metric,\r\ncount(wl.workorderid) as value\r\n\r\nfrom (select * from work_log where \r\n($TEAM = 'All Teams' OR userid in (select userid from user_teams where user_teams.teamid=$TEAM))\r\nand ($USERID = 'All Users' OR userid = $USERID) \r\nand ($GUIDE_ID = 'All Guides' or work_log.guideid = $GUIDE_ID)\r\nand  starttime BETWEEN '${__from:date:seconds}' AND '${__to:date:seconds}'\r\nand cancelled <> 1) wl\r\n\r\nleft JOIN global_users using(userid)\r\n\r\n\r\nleft JOIN (\r\n    SELECT gtr_revisionid, guideid, MAX(guide_revisionid) AS maxrevision FROM guide_revisions GROUP BY guideid\r\n  ) maxrev ON maxrev.guideid = wl.guideid \r\n\r\nleft JOIN guide_revisions ON guide_revisions.guide_revisionid = maxrev.maxrevision\r\n\r\n\r\nleft JOIN guide_meta ON guide_revisions.gtr_revisionid = guide_meta.revisionid\r\nleft JOIN guide_text ON guide_text.gt_revisionid = guide_revisions.gt_revisionid\r\n\r\nwhere \r\n\r\n\r\n($CATEGORYID = 'All Categories' OR guide_meta.device = $CATEGORYID) \r\n\r\ngroup by date_format(from_unixtime(wl.starttime), \"%d-%m-%y\")\r\n\r\norder by time_sec asc\r\n;\r\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Work Order Historical Trend",
      "tooltip": {
        "shared": true,
        "sort": 2,
        "value_type": "individual"
      },
      "transparent": true,
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "decimals": 0,
          "format": "none",
          "label": "Work Orders",
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": false
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": 100
      }
    },
    {
      "collapsed": false,
      "datasource": null,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 14
      },
      "id": 13,
      "panels": [],
      "title": "Work Order Details",
      "type": "row"
    },
    {
      "columns": [],
      "datasource": "$GUIDE_DB",
      "description": "Filtered by team, user, category, guide, and date range.",
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 20,
        "w": 24,
        "x": 0,
        "y": 15
      },
      "id": 3,
      "links": [],
      "pageSize": null,
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 5,
        "desc": true
      },
      "styles": [
        {
          "alias": "Time",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "alias": "",
          "align": "auto",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "link": true,
          "linkTargetBlank": true,
          "linkUrl": "${__cell:raw}",
          "mappingType": 1,
          "pattern": "Link",
          "sanitize": true,
          "thresholds": [],
          "type": "string",
          "unit": "short"
        },
        {
          "alias": "",
          "align": "auto",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "MM/DD/YY h:mm:ss a",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "Start Time",
          "thresholds": [],
          "type": "date",
          "unit": "short"
        },
        {
          "alias": "",
          "align": "auto",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "MM/DD/YY h:mm:ss a",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "Finish Time",
          "thresholds": [],
          "type": "date",
          "unit": "short"
        },
        {
          "alias": "",
          "align": "auto",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "Duration",
          "thresholds": [],
          "type": "number",
          "unit": "dthms"
        },
        {
          "alias": "",
          "align": "auto",
          "colorMode": null,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 2,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "alias": "",
          "format": "table",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "select \nwl.workorderid as \"Workorder ID\",\nguide_text.title as \"Guide Name\",\nguide_meta.device as \"Category\",\nglobal_users.username as \"User\",\nCASE \n    WHEN wl.endtime is NULL then \"In Progress\"\n    ELSE SEC_TO_TIME(wl.endtime - wl.starttime)\nEND as \"Duration\",\nwl.starttime*1000 as \"Start Time\", \nwl.endtime*1000 as \"Finish Time\",\nCONCAT('https://','$SITE_NAME','.dozuki.com/Guide/Process/',wl.guideid) as \"Link\"\n\nfrom (select * from work_log where \n($TEAM = 'All Teams' OR userid in (select userid from user_teams where user_teams.teamid=$TEAM))\nand ($USERID = 'All Users' OR userid = $USERID) \nand ($GUIDE_ID = 'All Guides' or work_log.guideid = $GUIDE_ID)\nand  starttime BETWEEN '${__from:date:seconds}' AND '${__to:date:seconds}'\nand cancelled <> 1) wl\n\nleft JOIN global_users on wl.userid=global_users.userid  \n\n\nleft JOIN (\n    SELECT gtr_revisionid, guideid, MAX(guide_revisionid) AS maxrevision FROM guide_revisions GROUP BY guideid\n  ) maxrev ON maxrev.guideid = wl.guideid \n\nleft JOIN guide_revisions ON guide_revisions.guide_revisionid = maxrev.maxrevision\n\n\nleft JOIN guide_meta ON guide_revisions.gtr_revisionid = guide_meta.revisionid\nleft JOIN guide_text ON guide_text.gt_revisionid = guide_revisions.gt_revisionid\n\n\nwhere \n\n\n($CATEGORYID = 'All Categories' OR guide_meta.device = $CATEGORYID) \n\norder by wl.starttime desc\n",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Work Order Details",
      "transform": "table",
      "transparent": true,
      "type": "table-old"
    }
  ],
  "refresh": false,
  "schemaVersion": 26,
  "style": "dark",
  "tags": [
    "Work Orders",
    "Work Order History"
  ],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "Dozuki",
          "value": "Dozuki"
        },
        "hide": 2,
        "includeAll": false,
        "label": "Guide Database",
        "multi": false,
        "name": "GUIDE_DB",
        "options": [],
        "query": "mysql",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "text": "<sitename>",
          "value": "<sitename>"
        },
        "hide": 2,
        "label": "Site Name",
        "name": "SITE_NAME",
        "options": [
          {
            "selected": true,
            "text": "<sitename>",
            "value": "<sitename>"
          }
        ],
        "query": "<sitename>",
        "skipUrlSync": false,
        "type": "constant"
      },
      {
        "allValue": "'All Teams'",
        "current": {
          "selected": false,
          "text": "All",
          "value": "$__all"
        },
        "datasource": "$GUIDE_DB",
        "definition": " select CONCAT(name, \" — \", \"Team ID:\", teamid) AS __text, teamid AS __value FROM teams",
        "hide": 0,
        "includeAll": true,
        "label": "Team",
        "multi": false,
        "name": "TEAM",
        "options": [],
        "query": " select CONCAT(name, \" — \", \"Team ID:\", teamid) AS __text, teamid AS __value FROM teams",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      },
      {
        "allValue": "'All Users'",
        "current": {
          "selected": false,
          "text": "All",
          "value": "$__all"
        },
        "datasource": "$GUIDE_DB",
        "definition": "select  CONCAT(global_users.username, \" — \", \"User ID:\", global_users.userid) AS __text, global_users.userid AS __value from global_users where userid in (select userid from user_teams where ($TEAM=teamid or $TEAM='All Teams'))",
        "hide": 0,
        "includeAll": true,
        "label": "User",
        "multi": false,
        "name": "USERID",
        "options": [],
        "query": "select  CONCAT(global_users.username, \" — \", \"User ID:\", global_users.userid) AS __text, global_users.userid AS __value from global_users where userid in (select userid from user_teams where ($TEAM=teamid or $TEAM='All Teams'))",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      },
      {
        "allValue": "'All Categories'",
        "current": {
          "selected": false,
          "text": "All",
          "value": "$__all"
        },
        "datasource": "$GUIDE_DB",
        "definition": "select  \"All Categories\", list.title as \"Category\" from (select distinct title from wikis where wikis.namespace=\"TOPIC\") list order by 'All Categories', title ASC",
        "hide": 0,
        "includeAll": true,
        "label": "Category",
        "multi": false,
        "name": "CATEGORYID",
        "options": [],
        "query": "select  \"All Categories\", list.title as \"Category\" from (select distinct title from wikis where wikis.namespace=\"TOPIC\") list order by 'All Categories', title ASC",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 5,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      },
      {
        "allValue": "'All Guides'",
        "current": {
          "selected": false,
          "text": "All",
          "value": "$__all"
        },
        "datasource": "$GUIDE_DB",
        "definition": "select guide_text.guideid AS __value,   CONCAT(guide_text.title, \" — \", \"Guide ID:\",  guide_text.guideid) AS __text    from guide_current \nleft join guide_revisions using(guide_revisionid)\nleft join guide_text using(gt_revisionid)\nleft JOIN guide_meta ON guide_revisions.gtr_revisionid = guide_meta.revisionid\n\nwhere device in (select device from guide_meta where ($CATEGORYID=device or $CATEGORYID='All Categories'))\n\n\n",
        "hide": 0,
        "includeAll": true,
        "label": "Guide",
        "multi": false,
        "name": "GUIDE_ID",
        "options": [],
        "query": "select guide_text.guideid AS __value,   CONCAT(guide_text.title, \" — \", \"Guide ID:\",  guide_text.guideid) AS __text    from guide_current \nleft join guide_revisions using(guide_revisionid)\nleft join guide_text using(gt_revisionid)\nleft JOIN guide_meta ON guide_revisions.gtr_revisionid = guide_meta.revisionid\n\nwhere device in (select device from guide_meta where ($CATEGORYID=device or $CATEGORYID='All Categories'))\n\n\n",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 5,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      }
    ]
  },
  "time": {
    "from": "now-30d",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "6h",
      "12h",
      "24h",
      "2d",
      "7d",
      "30d"
    ]
  },
  "timezone": "browser",
  "title": "Work Order History",
  "uid": null,
  "version": 45
}
