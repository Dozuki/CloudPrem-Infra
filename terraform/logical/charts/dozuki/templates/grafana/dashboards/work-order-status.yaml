apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: work-order-status-primary
spec:
  resyncPeriod: "24h"
  folder: "Primary"
  plugins:
    - name: grafana-piechart-panel
      version: 1.3.9
  instanceSelector:
    matchLabels:
      dashboards: "grafana-primary"
  jsonnet: |
    local SITE_NAME = 'onprem';
    local SITE_URL = '{{ .Values.hostname }}';
    local DATASOURCE = 'MySQL';
    
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": "-- Grafana --",
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "description": "This dashboard shows the current status of a given work order.",
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "id": null,
      "iteration": 1585170051584,
      "links": [],
      "panels": [
        {
          "content": "# Work Order Status\nLook up the current \"route\" status of a given work order.",
          "datasource": null,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "gridPos": {
            "h": 3,
            "w": 16,
            "x": 0,
            "y": 0
          },
          "id": 5,
          "links": [],
          "mode": "markdown",
          "options": {
            "content": "# Work Order Status\nLook up the current \"route\" status of a given work order.",
            "mode": "markdown"
          },
          "pluginVersion": "7.1.0",
          "title": "",
          "transparent": true,
          "type": "text"
        },
        {
          "collapsed": false,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 3
          },
          "id": 7,
          "panels": [],
          "title": "",
          "type": "row"
        },
        {
          "content": "<h2>Current Route Selected\n<hr>",
          "datasource": null,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "gridPos": {
            "h": 3,
            "w": 24,
            "x": 0,
            "y": 4
          },
          "id": 14,
          "links": [],
          "mode": "html",
          "options": {
            "content": "<h2>Current Route Selected\n<hr>",
            "mode": "html"
          },
          "pluginVersion": "7.1.0",
          "title": "",
          "transparent": true,
          "type": "text"
        },
        {
          "columns": [],
          "datasource": DATASOURCE,
          "description": "",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fontSize": "100%",
          "gridPos": {
            "h": 10,
            "w": 11,
            "x": 0,
            "y": 7
          },
          "id": 9,
          "links": [],
          "pageSize": 8,
          "scroll": false,
          "showHeader": true,
          "sort": {
            "col": 0,
            "desc": false
          },
          "styles": [
            {
              "$$hashKey": "object:1271",
              "alias": "Time",
              "align": "auto",
              "dateFormat": "MMMM D, YYYY LT",
              "pattern": "Time",
              "type": "date"
            },
            {
              "$$hashKey": "object:1272",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Minimum Time",
              "thresholds": [],
              "type": "hidden",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1273",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Maximum Time",
              "thresholds": [],
              "type": "hidden",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1274",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 0,
              "mappingType": 1,
              "pattern": "Route Step",
              "preserveFormat": true,
              "sanitize": true,
              "thresholds": [],
              "type": "number",
              "unit": "none"
            },
            {
              "$$hashKey": "object:1275",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "link": true,
              "linkTooltip": "https://" + SITE_URL + "/guide/${__cell:raw}/${__cell_3:raw}",
              "linkUrl": "https://" + SITE_URL + "/guide/${__cell:raw}/${__cell_3:raw}",
              "mappingType": 1,
              "pattern": "Guide Title",
              "preserveFormat": false,
              "sanitize": true,
              "thresholds": [],
              "type": "string",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1276",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Category",
              "preserveFormat": false,
              "sanitize": true,
              "thresholds": [],
              "type": "string",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1277",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 0,
              "mappingType": 1,
              "pattern": "Guide ID",
              "thresholds": [],
              "type": "number",
              "unit": "none"
            },
            {
              "$$hashKey": "object:1278",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "decimals": 2,
              "pattern": "/.*/",
              "thresholds": [],
              "type": "number",
              "unit": "none"
            }
          ],
          "targets": [
            {
              "alias": "",
              "format": "table",
              "group": [],
              "hide": false,
              "metricColumn": "none",
              "rawQuery": true,
              "rawSql": "SELECT  \r\n       @rownum := @rownum + 1 AS \"Route Step\", t.*\r\n  FROM (SELECT DISTINCT  `gt`.`title`  As \"Guide Title\", `gm`.`device` as \"Category\", `gc`.`guideid` As \"Guide ID\" ,\r\n\t\tCASE\r\n\t\t WHEN gm.time_required_min is not null \r\n\t\t THEN SEC_TO_TIME(gm.time_required_min) \r\n\t\t ELSE 0\r\n\t\tEND as \"Minimum Time\", \r\n\t\tCASE\r\n\t\t WHEN gm.time_required_max is not null \r\n\t\t THEN SEC_TO_TIME(gm.time_required_max) \r\n\t\t ELSE 0\r\n\t\tEND as \"Maximum Time\"\r\nFROM `guide_current` `gc`\r\nJOIN `guide_revisions` `gr` USING (`guide_revisionid`)\r\nJOIN `guide_meta` `gm` ON `gm`.`revisionid` = `gr`.`gtr_revisionid`\r\nJOIN `guide_text` `gt` ON `gr`.`gt_revisionid` = `gt`.`gt_revisionid`\r\nLEFT JOIN `work_log` `wl` ON `gc`.`guideid` = `wl`.`guideid`\r\n\r\nWHERE \r\nCASE \r\n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID = 'All Categories'\r\n\tTHEN 1 = 1\r\n\t\r\n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID != 'All Categories'\r\n\tTHEN gm.device = $CATEGORYID\r\n\t\r\n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID = 'All Categories'\r\n\tTHEN wl.workorderid = $WORKORDERID\r\n\t\t  \r\n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID != 'All Categories'\r\n\tTHEN gm.device = $CATEGORYID\r\n\r\nEND\r\n\r\nORDER BY `gc`.`guideid` ASC) t, \r\n       (SELECT @rownum := 0) r\r\norder by \"Route Step\" asc",
              "refId": "A",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "column"
                  }
                ]
              ],
              "timeColumn": "time",
              "where": [
                {
                  "name": "$__timeFilter",
                  "params": [],
                  "type": "macro"
                }
              ]
            }
          ],
          "title": "Work Order Route",
          "transform": "table",
          "transparent": true,
          "type": "table-old"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "#299c46",
            "rgba(237, 129, 40, 0.89)",
            "#d44a3a"
          ],
          "datasource": DATASOURCE,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "format": "none",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 7,
            "x": 11,
            "y": 7
          },
          "id": 12,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": false,
            "lineColor": "rgb(31, 120, 193)",
            "show": false
          },
          "tableColumn": "",
          "targets": [
            {
              "alias": "",
              "format": "table",
              "group": [],
              "metricColumn": "none",
              "rawQuery": true,
              "rawSql": "select \nCASE\n\tWHEN SUM(gm.time_required_min) <= 3020400\n\tTHEN SEC_TO_TIME(SUM(gm.time_required_min)) \t\n\tWHEN SUM(gm.time_required_min) > 3020400\n\tTHEN \"838:59:59+\"\n\tELSE \"None\"\nEND as \"Minimum Time\"\nFROM guide_current gc\nJOIN guide_revisions gr USING (guide_revisionid)\nJOIN guide_meta gm ON (gr.gtr_revisionid = gm.revisionid)\nwhere gc.guideid in (SELECT DISTINCT `gc`.`guideid` As \"Guide ID\"\nFROM `guide_current` `gc`\nJOIN `guide_revisions` `gr` USING (`guide_revisionid`)\nJOIN `guide_meta` `gm` ON `gm`.`revisionid` = `gr`.`gtr_revisionid`\nJOIN `guide_text` `gt` ON `gr`.`gt_revisionid` = `gt`.`gt_revisionid`\nLEFT JOIN `work_log` `wl` ON `gc`.`guideid` = `wl`.`guideid`\nWHERE \nCASE \n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID = 'All Categories'\n\tTHEN 1 = 1\n\t\n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID != 'All Categories'\n\tTHEN gm.device = $CATEGORYID\n\t\n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID = 'All Categories'\n\tTHEN wl.workorderid = $WORKORDERID\n\t\t  \n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID != 'All Categories'\n\tTHEN gm.device = $CATEGORYID\n\nEND\nORDER BY `gc`.`guideid` ASC)\n",
              "refId": "A",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "column"
                  }
                ]
              ],
              "timeColumn": "time",
              "where": [
                {
                  "name": "$__timeFilter",
                  "params": [],
                  "type": "macro"
                }
              ]
            }
          ],
          "thresholds": "",
          "title": "Minimum Route Time",
          "transparent": true,
          "type": "singlestat",
          "valueFontSize": "170%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "first"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "#299c46",
            "rgba(237, 129, 40, 0.89)",
            "#d44a3a"
          ],
          "datasource": DATASOURCE,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "format": "none",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 18,
            "y": 7
          },
          "id": 13,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "steps",
          "postfixFontSize": "80%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": false,
            "lineColor": "rgb(31, 120, 193)",
            "show": false
          },
          "tableColumn": "",
          "targets": [
            {
              "alias": "",
              "format": "table",
              "group": [],
              "metricColumn": "none",
              "rawQuery": true,
              "rawSql": "select max(x.Route_Step) as \"Step Count\"\nFROM (SELECT  \n       @rownum := @rownum + 1 AS \"Route_Step\", t.*\n  FROM (SELECT DISTINCT  `gt`.`title`  As \"Guide Title\", `gm`.`device` as \"Category\", `gc`.`guideid` As \"Guide ID\"\nFROM `guide_current` `gc`\nJOIN `guide_revisions` `gr` USING (`guide_revisionid`)\nJOIN `guide_meta` `gm` ON `gm`.`revisionid` = `gr`.`gtr_revisionid`\nJOIN `guide_text` `gt` ON `gr`.`gt_revisionid` = `gt`.`gt_revisionid`\nLEFT JOIN `work_log` `wl` ON `gc`.`guideid` = `wl`.`guideid`\nWHERE \nCASE \n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID = 'All Categories'\n\tTHEN 1 = 1\n\t\n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID != 'All Categories'\n\tTHEN gm.device = $CATEGORYID\n\t\n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID = 'All Categories'\n\tTHEN wl.workorderid = $WORKORDERID\n\t\t  \n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID != 'All Categories'\n\tTHEN gm.device = $CATEGORYID\n\nEND\nORDER BY `gc`.`guideid` ASC) t, \n       (SELECT @rownum := 0) r) x\n",
              "refId": "A",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "column"
                  }
                ]
              ],
              "timeColumn": "time",
              "where": [
                {
                  "name": "$__timeFilter",
                  "params": [],
                  "type": "macro"
                }
              ]
            }
          ],
          "thresholds": "",
          "title": "# of Route Steps",
          "transparent": true,
          "type": "singlestat",
          "valueFontSize": "170%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "avg"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "#299c46",
            "rgba(237, 129, 40, 0.89)",
            "#d44a3a"
          ],
          "datasource": DATASOURCE,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "format": "none",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 7,
            "x": 11,
            "y": 11
          },
          "id": 11,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": false,
            "lineColor": "rgb(31, 120, 193)",
            "show": false
          },
          "tableColumn": "",
          "targets": [
            {
              "alias": "",
              "format": "table",
              "group": [],
              "metricColumn": "none",
              "rawQuery": true,
              "rawSql": "select CASE\n\tWHEN SUM(gm.time_required_max) <= 3020400\n\tTHEN SEC_TO_TIME(SUM(gm.time_required_max)) \t\n\tWHEN SUM(gm.time_required_max) > 3020400\n\tTHEN \"838:59:59+\"\n\tELSE \"None\"\nEND as \"Maximum Time\"\nFROM guide_current gc\nJOIN guide_revisions gr USING (guide_revisionid)\nJOIN guide_meta gm ON (gr.gtr_revisionid = gm.revisionid)\nwhere gc.guideid in (SELECT DISTINCT `gc`.`guideid` As \"Guide ID\"\nFROM `guide_current` `gc`\nJOIN `guide_revisions` `gr` USING (`guide_revisionid`)\nJOIN `guide_meta` `gm` ON `gm`.`revisionid` = `gr`.`gtr_revisionid`\nJOIN `guide_text` `gt` ON `gr`.`gt_revisionid` = `gt`.`gt_revisionid`\nLEFT JOIN `work_log` `wl` ON `gc`.`guideid` = `wl`.`guideid`\nWHERE \nCASE \n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID = 'All Categories'\n\tTHEN 1 = 1\n\t\n\tWHEN $WORKORDERID = 'All Work Orders' AND $CATEGORYID != 'All Categories'\n\tTHEN gm.device = $CATEGORYID\n\t\n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID = 'All Categories'\n\tTHEN wl.workorderid = $WORKORDERID\n\t\t  \n\tWHEN $WORKORDERID != 'All Work Orders' AND $CATEGORYID != 'All Categories'\n\tTHEN gm.device = $CATEGORYID\n\nEND\n\nORDER BY `gc`.`guideid` ASC)\n",
              "refId": "A",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "column"
                  }
                ]
              ],
              "timeColumn": "time",
              "where": [
                {
                  "name": "$__timeFilter",
                  "params": [],
                  "type": "macro"
                }
              ]
            }
          ],
          "thresholds": "",
          "title": "Maximum Route Time",
          "transparent": true,
          "type": "singlestat",
          "valueFontSize": "170%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "first"
        },
        {
          "content": "<h2>Work Order Route Details\n<hr>",
          "datasource": null,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "gridPos": {
            "h": 3,
            "w": 24,
            "x": 0,
            "y": 17
          },
          "id": 15,
          "links": [],
          "mode": "html",
          "options": {
            "content": "<h2>Work Order Route Details\n<hr>",
            "mode": "html"
          },
          "pluginVersion": "7.1.0",
          "title": " ",
          "transparent": true,
          "type": "text"
        },
        {
          "columns": [],
          "datasource": DATASOURCE,
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fontSize": "100%",
          "gridPos": {
            "h": 15,
            "w": 24,
            "x": 0,
            "y": 20
          },
          "id": 3,
          "links": [],
          "pageSize": 16,
          "scroll": false,
          "showHeader": true,
          "sort": {
            "col": 6,
            "desc": true
          },
          "styles": [
            {
              "$$hashKey": "object:1447",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "link": true,
              "linkTargetBlank": true,
              "linkUrl": "${__cell}",
              "mappingType": 1,
              "pattern": "Link",
              "thresholds": [],
              "type": "hidden",
              "unit": "none"
            },
            {
              "$$hashKey": "object:1448",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Duration",
              "thresholds": [],
              "type": "number",
              "unit": "dthms"
            },
            {
              "$$hashKey": "object:1449",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 0,
              "mappingType": 1,
              "pattern": "Guide ID",
              "thresholds": [],
              "type": "number",
              "unit": "none"
            },
            {
              "$$hashKey": "object:1450",
              "alias": "",
              "align": "auto",
              "colorMode": "cell",
              "colors": [
                "rgba(176, 172, 172, 0.9)",
                "rgb(229, 210, 14)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Status",
              "thresholds": [
                "1",
                "2"
              ],
              "type": "string",
              "unit": "short",
              "valueMaps": [
                {
                  "$$hashKey": "object:1541",
                  "text": "Canceled",
                  "value": "-1"
                },
                {
                  "$$hashKey": "object:1542",
                  "text": "Not Started",
                  "value": "0"
                },
                {
                  "$$hashKey": "object:1543",
                  "text": "In Progress",
                  "value": "1"
                },
                {
                  "$$hashKey": "object:1544",
                  "text": "Completed",
                  "value": "2"
                }
              ]
            },
            {
              "$$hashKey": "object:1451",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD hh:mm a",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Started",
              "thresholds": [],
              "type": "date",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1452",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD hh:mm a",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "Ended",
              "thresholds": [],
              "type": "date",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1453",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 0,
              "mappingType": 1,
              "pattern": "User ID",
              "thresholds": [],
              "type": "number",
              "unit": "none"
            },
            {
              "$$hashKey": "object:1454",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "link": true,
              "linkTargetBlank": true,
              "linkTooltip": "https://" + SITE_URL + "/guide/${__cell:raw}/${__cell_1:raw}",
              "linkUrl": "https://" + SITE_URL + "/guide/${__cell:raw}/${__cell_1:raw}",
              "mappingType": 1,
              "pattern": "Guide Title",
              "thresholds": [],
              "type": "string",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1455",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "link": true,
              "linkTargetBlank": true,
              "linkTooltip": "",
              "linkUrl": "https://" + SITE_URL + "/Manage/work_log/view/${__cell_1:raw}/${__cell_3:raw}/PDF",
              "mappingType": 1,
              "pattern": "PDF Log",
              "thresholds": [],
              "type": "string",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1456",
              "alias": "Work Log ID",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 0,
              "mappingType": 1,
              "pattern": "entryid",
              "thresholds": [],
              "type": "hidden",
              "unit": "none"
            },
            {
              "$$hashKey": "object:1457",
              "alias": "Work Order",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "dateFormat": "YYYY-MM-DD HH:mm:ss",
              "decimals": 2,
              "mappingType": 1,
              "pattern": "workorderid",
              "thresholds": [],
              "type": "string",
              "unit": "short"
            },
            {
              "$$hashKey": "object:1458",
              "alias": "",
              "align": "auto",
              "colorMode": null,
              "colors": [
                "rgba(245, 54, 54, 0.9)",
                "rgba(237, 129, 40, 0.89)",
                "rgba(50, 172, 45, 0.97)"
              ],
              "decimals": 0,
              "pattern": "/.*/",
              "thresholds": [],
              "type": "number",
              "unit": "none"
            }
          ],
          "targets": [
            {
              "alias": "",
              "format": "table",
              "group": [],
              "hide": false,
              "metricColumn": "none",
              "rawQuery": true,
              "rawSql": "SELECT \r\nb.Category,\r\nb.guideid as \"Guide ID\", \r\nb.title as \"Guide Title\",\r\nwl.entryid,\r\n\r\n\r\n-- CASE \r\n  -- WHEN wl.workorderid is NOT NULL THEN wl.workorderid\r\n --  ELSE '--'\r\n-- END \r\nwl.workorderid,\r\n\r\nwl.userid as \"User ID\",\r\n \r\nCONVERT_TZ(from_unixtime(wl.starttime), @@session.time_zone, '+00:00') as \"Started\", \r\n\r\nCONVERT_TZ(from_unixtime(wl.endtime), @@session.time_zone, '+00:00')  as \"Ended\", \r\n\r\nCASE \r\n  WHEN wl.cancelled = 0 AND endtime is NOT NULL THEN '2'\r\n  WHEN wl.cancelled = 0 AND endtime is NULL THEN '1'\r\n  WHEN wl.cancelled = 1 THEN '-1'\r\n  WHEN wl.starttime IS NULL THEN '0'\r\nEND as \"Status\", \r\n\r\nCASE \r\n    WHEN wl.endtime is NULL and wl.starttime is not NULL then \"In Progress\"\r\n    WHEN wl.endtime is NULL and wl.starttime is NULL then \"--\"\r\n    ELSE SEC_TO_TIME(wl.endtime - wl.starttime) \r\nEND as Duration\r\n\r\n, \"PDF Log\" as \"PDF Log\"\r\n\r\nFROM work_log wl\r\n\r\nleft JOIN \r\n\r\n(SELECT DISTINCT gc.guideid, gt.title, gm.device as \"Category\", gr.gsr_revisionid\r\nFROM guide_current gc\r\nJOIN guide_revisions gr USING (guide_revisionid)\r\nJOIN guide_meta gm ON gm.revisionid = gr.gtr_revisionid\r\nJOIN guide_text gt ON gr.gt_revisionid = gt.gt_revisionid\r\n\r\nORDER BY gc.guideid ASC) b\r\n\r\nON wl.guideid = b.guideid \r\n\r\n\r\n-- Find Current Step\r\nleft join guide_step_revisions gsr on gsr.revisionid=b.gsr_revisionid\t\t\t\r\nleft join (select work_log_timing.timingid, work_log_timing.stepid, work_log_timing.entryid \r\n\t\t   from work_log_timing\r\n\t\t   inner join (select stepid, entryid, max(timingid) as maxtime\r\n\t\t\t\t\t   from work_log_timing\r\n\t\t\t\t\t   group by work_log_timing.entryid) maxt\r\n\t\t   on work_log_timing.timingid=maxt.maxtime and work_log_timing.entryid=maxt.entryid) current_step\r\n\t\t\t\r\n\t\t\ton current_step.entryid=wl.entryid\r\n\r\n-- Find step number\r\nleft join (select guide_step_order_revisions.gtr_revisionid, guide_step_order_revisions.stepid, guide_step_order_revisions.orderby\r\n\r\nfrom guide_step_order_revisions\r\n\r\ninner join (Select stepid, max(gtr_revisionid) as maxrev\r\nfrom guide_step_order_revisions\r\ngroup by guide_step_order_revisions.stepid) mrv\r\n\r\non guide_step_order_revisions.gtr_revisionid=mrv.maxrev and guide_step_order_revisions.stepid=mrv.stepid) step_number on step_number.stepid = current_step.stepid\r\n\r\n-- \t\t\t\r\n\r\n\r\n\r\nWHERE \r\n\r\n/* Case statement to use WHERE clause appropriate to which filters were selected  */\r\n\r\n\r\n($WORKORDERID = 'All Work Orders' OR wl.workorderid = $WORKORDERID)\r\n\r\nAND ($CATEGORYID = 'All Categories' OR b.category = $CATEGORYID)\r\n\r\n\t\r\n\tgroup by wl.entryid",
              "refId": "A",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "column"
                  }
                ]
              ],
              "timeColumn": "time",
              "where": [
                {
                  "name": "$__timeFilter",
                  "params": [],
                  "type": "macro"
                }
              ]
            }
          ],
          "title": " ",
          "transform": "table",
          "transparent": true,
          "type": "table-old"
        }
      ],
      "refresh": false,
      "schemaVersion": 26,
      "style": "dark",
      "tags": [
        "Work Orders",
        "Work Order Status"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "selected": false,
              "text": "Dozuki",
              "value": "Dozuki"
            },
            "hide": 2,
            "includeAll": false,
            "label": "Guide Database",
            "multi": false,
            "name": "GUIDE_DB",
            "options": [],
            "query": "mysql",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "type": "datasource"
          },
          {
            "allValue": "'All Work Orders'",
            "current": {
              "selected": false,
              "text": "All",
              "value": "$__all"
            },
            "datasource": DATASOURCE,
            "definition": "select  work_log.workorderid  from work_log",
            "hide": 0,
            "includeAll": true,
            "label": "Work Order ID",
            "multi": false,
            "name": "WORKORDERID",
            "options": [],
            "query": "select  work_log.workorderid  from work_log",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": "'All Categories'",
            "current": {
              "selected": false,
              "text": "All",
              "value": "$__all"
            },
            "datasource": DATASOURCE,
            "definition": "select  list.title as \"Category\" from (select distinct title from wikis where wikis.namespace=\"TOPIC\") list order by 'All Categories', title ASC",
            "hide": 0,
            "includeAll": true,
            "label": "Category",
            "multi": false,
            "name": "CATEGORYID",
            "options": [],
            "query": "select  list.title as \"Category\" from (select distinct title from wikis where wikis.namespace=\"TOPIC\") list order by 'All Categories', title ASC",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": SITE_NAME,
              "value": SITE_NAME
            },
            "hide": 2,
            "includeAll": false,
            "label": "Site Name",
            "multi": false,
            "name": "SITE_NAME",
            "options": [
              {
                "selected": true,
                "text": SITE_NAME,
                "value": SITE_NAME
              }
            ],
            "query": SITE_NAME,
            "skipUrlSync": false,
            "type": "custom"
          }
        ]
      },
      "time": {
        "from": "now-30d",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "browser",
      "title": "Work Order Status",
      "uid": null,
      "version": 37
    }
